<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>优秀论文基本信息表</title>
    <link href="../static/css/bootstrap.css" th:href="@{/css/bootstrap.css}" rel="stylesheet" />
    <link href="../static/css/bootstrap-theme.css" th:href="@{/css/bootstrap-theme.css}" rel="stylesheet" />
    <link href="../static/css/general.css" th:href="@{/css/general.css}" rel="stylesheet" />
    <link href="../static/css/layout.css" th:href="@{/css/layout.css}" rel="stylesheet" />
    <link href="../static/css/menu.css" th:href="@{/css/menu.css}" rel="stylesheet" />
    <link href="../static/css/master_thesis_apply_sheet.css" th:href="@{/css/master_thesis_apply_sheet.css}" rel="stylesheet" />
    <script type="text/javascript" src="../static/js/jquery-3.1.1.js" th:src="@{/js/jquery-3.1.1.js}"></script>
    <script type="text/javascript" src="../static/js/bootstrap.js" th:src="@{/js/bootstrap.js}"></script>
    <script type="text/javascript" src="../static/js/jquery.validate.js" th:src="@{/js/jquery.validate.js}"></script>
    <script type="text/javascript" src="../static/js/menu.js" th:src="@{/js/menu.js}"></script>
    <script type="text/javascript" src="../static/js/general_help.js" th:src="@{/js/general_help.js}"></script>
    <script type="text/javascript" src="../static/js/MyAjaxForm.js" th:src="@{/js/MyAjaxForm.js}"></script>
    <script type="text/javascript" src="../static/js/s_basic_info_validate.js" th:src="@{/js/s_basic_info_validate.js}"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            basic_info_validate();
            basic_info_submit();
            fileUpload();
            inputDisableToAble();
        });

        function basic_info_submit(){
            //  basic_info_form   basic_info_submit_btn
            //  ssdm   ssmc  xxdm   xxmc  zzxh  xh  cplx  gdfs  zzxm  xb
            // csny  mz  dsxm  lwtm  lwywtm  yjfx  lwzwgjz  lwys  gdlb  lwtjblj
            // lwywlj  rxny  hxwrq  yjxkm  yjxkmc  ejxkm  ejxkmc  zzzc  xxlxr  bz
            $("#basic_info_submit_btn").click(function(){
                if(checkFormValidateStatus() == false){
                    $("#m_table1_warn").html("未上传文件");
                    return;
                }
                $("#m_table1_warn").html("");
                $.ajax({
                    type: "POST",
                    url: "/home/student/apply/save/basicInfoTable",
                    contentType: "application/json",
                    data: JSON.stringify({
                        //  ssdm   ssmc  xxdm   xxmc  zzxh  xh  cplx  gdfs  zzxm  xb
                        "ssdm":$("#ssdm").val(),
                        "ssmc":$("#ssmc").val(),
                        "xxdm":$("#xxdm").val(),
                        "xxmc":$("#xxmc").val(),
                        "zzxh":$("#zzxh").val(),
                        "xh":$("#xh").val(),
                        "cplx":$("#cplx").val(),
                        "gdfs":$("#gdfs").val(),
                        "zzxm":$("#zzxm").val(),
                        "xb":$("#xb").val(),
                        // csny  mz  dsxm  lwtm  lwywtm  yjfx  lwzwgjz  lwys  gdlb  lwtjblj
                        "csny":$("#csny").val(),
                        "mz":$("#mz").val(),
                        "dsxm":$("#dsxm").val(),
                        "lwtm":$("#lwtm").val(),
                        "lwywtm":$("#lwywtm").val(),
                        "yjfx":$("#yjfx").val(),
                        "lwzwgjz":$("#lwzwgjz").val(),
                        "lwys":$("#lwys").val(),
                        "gdlb":$("#gdlb").val(),
                        "lwtjblj":$("#lwtjblj").val(),
                        // lwywlj  rxny  hxwrq  yjxkm  yjxkmc  ejxkm  ejxkmc  zzzc  xxlxr  bz
                        "lwywlj":$("#lwywlj").val(),
                        "rxny":$("#rxny").val(),
                        "hxwrq":$("#hxwrq").val(),
                        "yjxkm":$("#yjxkm").val(),
                        "yjxkmc":$("#yjxkmc").val(),
                        "ejxkm":$("#ejxkm").val(),
                        "ejxkmc":$("#ejxkmc").val(),
                        "zzzc":$("#zzzc").val(),
                        "xxlxr":$("#xxlxr").val(),
                        "bz":$("#bz").val(),
                    }),

                    beforeSend: function(XMLHttpRequest){
                    },

                    success: function(data){
                        var status = data.code;
                        var msg = data.msg;
                        if(status == "200")  //信息保存成功
                            model_tip_show('model_tip','model_tip_content','信息保存成功!');
                        else if(status == "500")  //服务器繁忙
                            model_tip_show('model_tip','model_tip_content','系统繁忙，请稍后再试!');
                        else
                            var empty = "";
                    },

                    error: function(XMLHttpRequest, textStatus) {
                    },

                    complete: function(XMLHttpRequest, textStatus){
                    }

                });
            }) //click

        }


        function checkFormValidateStatus(){
            // basic_info_form  fileUplodStatus
            var form_status = $("#basic_info_form").valid();
            var file_status = $("#fileUplodStatus").val();
            if (form_status == true) {
                if (file_status == '1') {
                    return true;
                }
            }

            return false;
        }

        function fileUpload(){
            // article_file    fileUpload_btn   file_status_warn
            $("#fileUpload_btn").click(function () {
                $("#file_status_warn").html("");
                $("#fileUplodStatus").val("0");
                var fileName = $("#article_file").val();
                //未选择文件
                if(fileName==""){
                    $("#file_status_warn").attr("class","text-danger");
                    $("#file_status_warn").html("没有选择文件!");
                    return;
                }
                //判断文件的后缀名是否为pdf
                var file_extent = fileName.substring(fileName.lastIndexOf(".")+1);
                if(file_extent!="pdf"){ //文件格式错误
                    $("#file_status_warn").attr("class","text-danger");
                    $("#file_status_warn").html("文件格式错误！");
                    return;
                }
                //文件后缀名正确，提交文件
                $("#file_submit_form").ajaxSubmit({
                    url: "upload.txt",
                    type: "post",
                    success: function (data) { //服务器回调函数
                        var status = data.code;
                        var msg = data.msg;
                        if(status == "200"){//文件上传成功
                            $("#file_status_warn").attr("class","text-info");
                            $("#file_status_warn").html("文件上传成功！");
                            $("#fileUplodStatus").val("1");

                        }
                        else if(status == "500"){//文件上传不成功
                            $("#file_status_warn").attr("class","text-danger");
                            $("#file_status_warn").html("服务器繁忙，请稍后再试！");
                        }

                        else
                            var empty = "";
                    } //success
                });

            })
        }

        function inputDisableToAble(){
            //前端已赋值:  ssdm  ssmc  xxdm  xxmc  zzxh  xxlxr
            //csny  dsxm  lwtm  lwtjblj  lwywlj  rxny
            //hxwrq  yjxkm  yjxkmc  ejxkm  ejxkmc
            $('input[disabled="disabled"]').removeAttr('disabled');
            $('select[disabled="disabled"]').removeAttr('disabled');
        }

    </script>

</head>
<body>

<div id="sheet_wrap">

    <div class="table_title">
        <span>湖北省优秀论文基本信息表</span>
    </div>


    <form id="basic_info_form" style="border-top: 1px solid black;">
        <table class="table" id="table0">
            <tbody>
            <tr>
                <td class="td_key">省市代码</td>
                <td><input type="text" disabled="disabled" id="ssdm" name="ssdm" value="42"/></td>
                <td class="td_key">省市名称</td>
                <td class="td_border_left"><input type="text" disabled="disabled" id="ssmc" name="ssmc" value="湖北省"/></td>
            </tr>
            <tr>
                <td class="td_key">学校代码</td>
                <td><input type="text" id="xxdm" name="xxdm" disabled="disabled" value="10487"/></td>
                <td class="td_key">学校名称</td>
                <td><input type="text" id="xxmc" name="xxmc" disabled="disabled" value="华中科技大学"/></td>
            </tr>

            <tr>
                <td class="td_key">作者学号</td>
                <td><input type="text" id="zzxh" name="zzxh" disabled="disabled" placeholder="请填写正确的学号" th:value="${thesisBasicInfo.zzxh}" /></td>
                <td class="td_key">序号</td><td><input type="text" id="xh" name="xh" disabled="disabled" placeholder="此项由学校管理员填写" th:value="${thesisBasicInfo.xh}" /></td>
            </tr>
            <tr>
                <td class="td_key"><span class="font_star">*</span>参评类型</td>
                <td>
                    <select id="cplx" name="cplx">
                        <option value="">请选择</option>
                        <option value="湖北省优秀硕士论文评选（已授学位）" th:if="${thesisBasicInfo.cplx} == '湖北省优秀硕士论文评选（已授学位）'" th:selected="selected">湖北省优秀硕士论文评选（已授学位）</option>
                        <option value="湖北省优秀硕士论文评选（已授学位）" th:unless="${thesisBasicInfo.cplx} == '湖北省优秀硕士论文评选（已授学位）'">湖北省优秀硕士论文评选（已授学位）</option>
                        <option value="湖北省优秀博士论文评选（已授学位）" th:if="${thesisBasicInfo.cplx} == '湖北省优秀博士论文评选（已授学位）'" th:selected="selected">湖北省优秀博士论文评选（已授学位）</option>
                        <option value="湖北省优秀博士论文评选（已授学位）" th:unless="${thesisBasicInfo.cplx} == '湖北省优秀博士论文评选（已授学位）'">湖北省优秀博士论文评选（已授学位）</option>
                    </select>
                </td>
                <td class="td_key"><span class="font_star">*</span>攻读方式</td>
                <td>
                    <select id="gdfs" name="gdfs">
                        <option value="">请选择</option>
                        <option value="统招生" th:if="${thesisBasicInfo.gdfs} == '统招生'" th:selected="selected">统招生</option>
                        <option value="统招生" th:unless="${thesisBasicInfo.gdfs} == '统招生'">统招生</option>
                        <option value="联合培养" th:if="${thesisBasicInfo.gdfs} == '联合培养'" th:selected="selected">联合培养</option>
                        <option value="联合培养" th:unless="${thesisBasicInfo.gdfs} == '联合培养'">联合培养</option>
                        <option value="在职攻读" th:if="${thesisBasicInfo.gdfs} == '在职攻读'" th:selected="selected">在职攻读</option>
                        <option value="在职攻读" th:unless="${thesisBasicInfo.gdfs} == '在职攻读'">在职攻读</option>
                        <option value="同等学力" th:if="${thesisBasicInfo.gdfs} == '同等学力'" th:selected="selected">同等学力</option>
                        <option value="同等学力" th:unless="${thesisBasicInfo.gdfs} == '同等学力'">同等学力</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="td_key"><span class="font_star">*</span>作者姓名</td>
                <td><input type="text" id="zzxm" name="zzxm" placeholder="姓名中间不允许有空格" th:value="${thesisBasicInfo.zzxm}" /></td>
                <td class="td_key"><span class="font_star">*</span>作者性别</td>
                <td>
                    <select id="xb" name="xb">
                        <option value="">请选择</option>
                        <option value="男" th:if="${thesisBasicInfo.xb} == '男'" th:selected="selected">男</option>
                        <option value="男" th:unless="${thesisBasicInfo.xb} == '男'">男</option>
                        <option value="女" th:if="${thesisBasicInfo.xb} == '女'" th:selected="selected">女</option>
                        <option value="女" th:unless="${thesisBasicInfo.xb} == '女'">女</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td class="td_key">出生年月</td>
                <td><input type="text" id="csny" name="csny" disabled="disabled" placeholder="如199109" th:value="${thesisBasicInfo.csny}" /></td>
                <td class="td_key">民族</td>
                <td><input type="text" id="mz" name="mz" placeholder="民族" th:value="${thesisBasicInfo.mz}" /></td>
            </tr>

            <tr>
                <td class="td_key"><span class="font_star">*</span>导师姓名</td>
                <td><input type="text" id="dsxm" name="dsxm" disabled="disabled" placeholder="导师姓名，限填1人" th:value="${thesisBasicInfo.dsxm}" /></td>
                <td class="td_key">论文题目</td>
                <td><input type="text" id="lwtm" name="lwtm" disabled="disabled" placeholder="论文题目" th:value="${thesisBasicInfo.lwtm}" /></td>
            </tr>

            <tr>
                <td class="td_key"><span class="font_star">*</span>论文英文题目</td>
                <td colspan="3"><input type="text" id="lwywtm" name="lwywtm" placeholder="论文英文题目，最大长度200" th:value="${thesisBasicInfo.lwywtm}" /></td>
            </tr>

            <tr>
                <td class="td_key"><span class="font_star">*</span>研究方向</td>
                <td><input type="text" id="yjfx" name="yjfx" placeholder="研究方向,最大长度100" th:value="${thesisBasicInfo.yjfx}" /></td>
                <td class="td_key"><span class="font_star">*</span>中文关键字</td>
                <td><input type="text" id="lwzwgjz" name="lwzwgjz" placeholder="中文关键字" th:value="${thesisBasicInfo.lwzwgjz}" /></td>
            </tr>

            <tr>
                <td class="td_key"><span class="font_star">*</span>论文页数</td>
                <td><input type="text" id="lwys" name="lwys" placeholder="论文页数，为数字，如72" th:value="${thesisBasicInfo.lwys}" /></td>
                <td class="td_key"><span class="font_star">*</span>攻读类别</td>
                <td>
                    <select id="gdlb" name="gdlb">
                        <option value="">请选择</option>
                        <option value="硕士学位" th:if="${thesisBasicInfo.gdlb} == '硕士学位'" th:selected="selected">硕士学位</option>
                        <option value="硕士学位" th:unless="${thesisBasicInfo.gdlb} == '硕士学位'">硕士学位</option>
                        <option value="硕士专业学位" th:if="${thesisBasicInfo.gdlb} == '硕士专业学位'" th:selected="selected">硕士专业学位</option>
                        <option value="硕士专业学位" th:unless="${thesisBasicInfo.gdlb} == '硕士专业学位'">硕士专业学位</option>
                        <option value="博士学位" th:if="${thesisBasicInfo.gdlb} == '博士学位'" th:selected="selected">博士学位</option>
                        <option value="博士学位" th:unless="${thesisBasicInfo.gdlb} == '博士学位'">博士学位</option>
                        <option value="博士专业学位" th:if="${thesisBasicInfo.gdlb} == '博士专业学位'" th:selected="selected">博士专业学位</option>
                        <option value="博士专业学位" th:unless="${thesisBasicInfo.gdlb} == '博士专业学位'">博士专业学位</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td class="td_key">Word论文推荐表路径</td>
                <td><input type="text" id="lwtjblj" name="lwtjblj" disabled="disabled" placeholder="由系统自动生成" th:value="${thesisBasicInfo.lwtjblj}" /></td>
                <td class="td_key">PDF论文原文路径</td>
                <td><input type="text" id="lwywlj" name="lwywlj" disabled="disabled" placeholder="由系统自动生成" th:value="${thesisBasicInfo.lwywlj}" /></td>
            </tr>

            <tr>
                <td class="td_key">入学年月</td><td>
                <input type="text" id="rxny" name="rxny" disabled="disabled" placeholder="入学年月"/></td>
                <td class="td_key">获学位日期</td>
                <td><input type="text" id="hxwrq" name="hxwrq" disabled="disabled" placeholder="获学位日期"/></td>
            </tr>

            <tr>
                <td class="td_key">一级学科码</td>
                <td><input type="text" id="yjxkm" name="yjxkm" disabled="disabled" placeholder="一级学科码"/></td>
                <td class="td_key">一级学科名称</td>
                <td><input type="text" id="yjxkmc" name="yjxkmc" disabled="disabled" placeholder="一级学科名称"/></td>
            </tr>

            <tr>
                <td class="td_key">二级学科码</td>
                <td><input type="text" id="ejxkm" name="ejxkm" disabled="disabled" placeholder="二级学科码"/></td>
                <td class="td_key">二级学科名称</td>
                <td><input type="text" id="ejxkmc" name="ejxkmc" disabled="disabled" placeholder="二级学科名称"/></td>
            </tr>

            <tr>
                <td class="td_key"><span class="font_star">*</span>作者职称</td>
                <td><input type="text" id="zzzc" name="zzzc" placeholder="作者职称，长度不超过10" th:value="${thesisBasicInfo.zzzc}"/></td>
                <td class="td_key">学校联系人</td>
                <td><input type="text" id="xxlxr" name="xxlxr" disabled="disabled" value="王老师"/></td>
            </tr>

            <tr>
                <td class="td_key"><span class="font_star">*</span>备注</td>
                <td colspan="3"><input type="text" id="bz" name="bz" placeholder="长度不超过100，只标注特殊情况，如论文为非中文撰写，如英语撰写的，请备注“英文撰写”" th:value="${thesisBasicInfo.bz}"/></td>
            </tr>
            <tr>
                <td class="td_key"><span class="font_star">*</span>论文上传（pdf格式）</td>
                <td colspan="1"><button type="button" id="file_btn">上传论文</button></td>
                <td colspan="2"><input type="text" id="fileUplodStatus" hidden="hidden" value="0"/></td>
            </tr>

            <script>
                $(document).ready(function () {
                  $("#file_btn").click(function () {

                      $("#fileUploadModal").modal();
                  })
                })

            </script>

            </tbody>
        </table>

    </form>

    <div class="checkTure">

        <div class="checkTure_btn_div">
            <button type="button" id="basic_info_submit_btn" class="btn btn-primary">信息确认无误，提交保存</button>

        </div>
        <div class="check_msg validate_warn" id="m_table1_warn">

        </div>

    </div>

    <!--<div class="submit_btn_div">-->
    <!--<button type="button" class="btn btn-primary btn-block">以上信息确认无误，提交到系统</button>-->
    <!--</div>-->

</div>


<!-- Model  -->
<!--调用方法:model_tip_show('model_tip','model_tip_content','系统繁忙请稍后再试!');-->

<div id="model_tip" class="modal" tabindex="-5" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" data-backdrop="static" >
    <div class="modal-dialog modal-sm model_size">
        <div class="modal-content">
            <div class="model_head">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h3 class="modal-title" id="myModalLabel" style="text-align: center">提示</h3>
            </div>
            <div class="model_body" id="model_tip_content">

            </div>
            <div class="model_foot">
                <div class="model_btn_close">
                    <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">关闭</button>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- Model  -->


<!--  文件上传 Model  -->
<!--调用方法:model_tip_show('model_tip','model_tip_content','系统繁忙请稍后再试!');-->

<div id="fileUploadModal" class="modal" tabindex="-5" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" data-backdrop="static" >
    <div class="modal-dialog modal-sm model_size" style="width:450px;height:450px">
        <div class="modal-content">
            <div class="model_head">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h3 class="modal-title" style="text-align: center">论文文件上传</h3>
            </div>
            <div class="model_body">
                <form id="file_submit_form" name="file_submit_form">
                    <div class="text-justify small text-danger">注意：论文为pdf格式，论文页眉、页脚和内容部分<strong>不能出现学校名称、作者姓名、导师姓名</strong>，否则会影响论文申请</div>
                    <input type="file" id="article_file" name="file" style="margin-top:20px" class="form-control"/>
                    <div id="file_status_warn" style="height:30px"></div>
                    <button type="button" id="fileUpload_btn" class="btn btn-default">上传论文</button>
                </form>

            </div>
            <div class="model_foot" style="padding-top: 50px;">
                <div class="model_btn_close">
                    <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">关闭</button>
                </div>

            </div>
        </div>
    </div>
</div>


<!-- file upload Model  -->

</body>
</html>